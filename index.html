<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- –û—Ç–∫–ª—é—á–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>–ò–≥—Ä–∞ –õ–∏–ª—è</title>
    <!-- –ú–æ–¥—É–ª—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã -->
    <script src="game-state-fixer.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="matrix-comment.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .game-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            max-width: 1600px;
            margin: 0 auto;
            transform: translateX(-4%);
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π */
        .horizontal-line {
            position: absolute;
            height: 2px;
            width: 100%;
            background-color: yellow;
            animation: pulse 1.5s infinite;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è —Ä–∞–¥—É–∂–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
        .rainbow-cell {
            animation: rainbowPulse 3s infinite;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            position: absolute;
            width: 40px;
            height: 40px;
            transition: all 0.3s ease;
        }

        @keyframes rainbowPulse {
            0% { background-color: #ff0000; transform: scale(1); }
            20% { background-color: #ff9900; transform: scale(1.1); }
            40% { background-color: #ffff00; transform: scale(1); }
            60% { background-color: #33cc33; transform: scale(1.1); }
            80% { background-color: #3399ff; transform: scale(1); }
            100% { background-color: #ff0000; transform: scale(1); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        /* –î–æ–±–∞–≤–∏–º —Å—Ç–∏–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ –ø—Ä–µ—Å–µ—Ç–µ –û–ú */
        .absolute-title {
            font-size: 20px !important; /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            line-height: 1.2 !important; /* –£–º–µ–Ω—å—à–∞–µ–º –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª */
            margin-bottom: 8px !important; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        }
        
        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ –ø—Ä–µ—Å–µ—Ç–µ –û–ú */
        .absolute-text {
            font-size: 14px !important; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            line-height: 1.3 !important; /* –£–º–µ–Ω—å—à–∞–µ–º –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø—Ä–µ—Å–µ—Ç –û–ú */
        .om-preset-initializing .game-board {
            transition: filter 1s ease-in-out, opacity 1s ease-in-out;
        }
        
        .om-preset-transitioning .game-board {
            animation: none !important; /* –û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–∞ */
        }
        
        .om-preset-active .game-board {
            animation: pulseGolden 4s infinite !important;
        }
        
        /* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –æ–ø–∏—Å–∞–Ω–∏—è */
        .om-description .box-title,
        .om-description .box-text {
            animation: descriptionPulse 3s infinite alternate;
        }
        
        @keyframes descriptionPulse {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
            100% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.7), 0 0 25px rgba(255, 215, 0, 0.4); }
        }
        
        /* –ó–æ–ª–æ—Ç–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
        @keyframes pulseGolden {
            0% { filter: sepia(100%) saturate(400%) hue-rotate(10deg) brightness(150%); }
            50% { filter: sepia(100%) saturate(600%) hue-rotate(10deg) brightness(170%); }
            100% { filter: sepia(100%) saturate(400%) hue-rotate(10deg) brightness(150%); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Add video container for the host (left side) -->
        <div class="video-container host-video">
            <video id="host-video" autoplay playsinline muted></video>
            <div class="video-controls">
                <button id="host-mic-toggle" class="control-button mic-button">üé§</button>
                <button id="host-camera-toggle" class="control-button camera-button">üì∑</button>
            </div>
            <div class="connection-status host-status">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
        </div>
        
        <div class="main-content">
            <div class="board-container">
                <img src="images/maket2.jpg" class="game-board" alt="Game Board">
                <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–µ—Ç–∫–∏ -->
                <div class="grid-container"></div>
                
                <!-- –ó–∞–º–µ–Ω—è–µ–º 3D –∫—É–±–∏–∫ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å —Ç–µ–∫—Å—Ç–æ–º –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ -->
                <div class="dice-container">
                    <div id="game-dice" class="text-dice click-invite">
                        <span class="click-text">click</span>
                    </div>
                </div>
                
                <!-- –î–æ–±–∞–≤–ª—è–µ–º –ë–û–ö —Å–ø—Ä–∞–≤–∞ –æ—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º -->
                <div class="cell-description-box">
                    <div class="box-content">
                        <h3 class="box-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
                        <div class="box-text">
                            –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤–∞—Å –Ω–∞ –ø—É—Ç–∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –ø–æ–∑–Ω–∞–Ω–∏—è! –ë—Ä–æ—Å—å—Ç–µ –∫—É–±–∏–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É. 
                            –î–ª—è —Å—Ç–∞—Ä—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å 6 - —Ç–æ–≥–¥–∞ –≤–∞—à–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –Ω–∞—á–Ω–µ—Ç—Å—è.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="message">–ë—Ä–æ—Å—å—Ç–µ –∫—É–±–∏–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É</div>
        </div>
        
        <!-- Add video container for the player (right side) -->
        <div class="video-container player-video">
            <video id="player-video" autoplay playsinline></video>
            <div class="video-controls">
                <button id="player-mic-toggle" class="control-button mic-button">üé§</button>
                <button id="player-camera-toggle" class="control-button camera-button">üì∑</button>
            </div>
            <div class="connection-status player-status">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
        </div>
    </div>

    <!-- –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º –∞—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç—ã, —Ç–∞–∫ –∫–∞–∫ —Ñ–∞–π–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç -->
    <!--
    <audio id="snake1" src="sounds/snake1.mp3" preload="auto"></audio>
    <audio id="snake2" src="sounds/snake2.mp3" preload="auto"></audio>
    <audio id="up1" src="sounds/Up1.mp3" preload="auto"></audio>
    <audio id="up2" src="sounds/Up2.mp3" preload="auto"></audio>
    -->

    <script src="script.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å–µ—Ç–∫–∏ -->
    <script src="grid-system.js"></script>
    <!-- –ú–æ–¥—É–ª—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç—Ä–µ–ª—ã 54 -> 68 -->
    <script src="arrow54to68.js"></script>
    
    <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∫–∞—Ä–º—ã -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–∞—Ä–º—ã
        window.activateKarmaEffect = function(cellNumber) {
            console.log(`–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∫–∞—Ä–º—ã –¥–ª—è –∫–ª–µ—Ç–∫–∏ ${cellNumber}`);
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–µ—Ç–∫–µ –∫–∞—Ä–º—ã
            const karmaCells = {
                5: { 
                    color: '#2ecc71', 
                    name: '–î—Ö–∞—Ä–º–∞', 
                    type: 'good',
                    description: '–ü—É—Ç—å –∏—Å—Ç–∏–Ω—ã –∏ –≤—ã—Å—à–µ–≥–æ –±–ª–∞–≥–∞. –í–∞—à–∞ –¥—É—à–∞ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–≤–µ—Ç–æ–º –∏ –±–ª–∞–≥–æ—Å—Ç—å—é.'
                },
                14: { 
                    color: '#3498db', 
                    name: '–ü–æ–ª–µ –¥—Ö–∞—Ä–º—ã', 
                    type: 'good',
                    description: '–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –¥—É—Ö–æ–≤–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –±–ª–∞–≥–∏—Ö –ø–æ—Å—Ç—É–ø–∫–æ–≤. –í–∞—à–∞ –∫–∞—Ä–º–∞ –æ—á–∏—â–∞–µ—Ç—Å—è.'
                },
                23: { 
                    color: '#9b59b6', 
                    name: '–ü–æ–ª–µ –∫–∞—Ä–º—ã', 
                    type: 'neutral',
                    description: '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ –∫–∞—Ä–º—ã - –∑–¥–µ—Å—å –≤—ã –æ—Å–æ–∑–Ω–∞–µ—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —Å–≤–æ–∏—Ö –ø—Ä–æ—à–ª—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.'
                },
                32: { 
                    color: '#1abc9c', 
                    name: '–ü–æ–ª–µ –º—É–¥—Ä–æ—Å—Ç–∏', 
                    type: 'good',
                    description: '–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤—ã—Å—à–µ–≥–æ –∑–Ω–∞–Ω–∏—è –∏ –º—É–¥—Ä–æ—Å—Ç–∏, –≥–¥–µ –≤—ã –ø–æ—Å—Ç–∏–≥–∞–µ—Ç–µ –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—Ä–æ–¥—É –≤–µ—â–µ–π.'
                },
                41: { 
                    color: '#f1c40f', 
                    name: '–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –ø–ª–∞–Ω', 
                    type: 'neutral',
                    description: '–°—Ñ–µ—Ä–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –≥–¥–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.'
                }
                // –î—Ä—É–≥–∏–µ –∫–ª–µ—Ç–∫–∏ –∫–∞—Ä–º—ã...
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª–µ—Ç–∫–∞ –∫–∞—Ä–º–∏—á–µ—Å–∫–æ–π
            const karmaInfo = karmaCells[cellNumber];
            if (!karmaInfo) {
                console.log(`–ö–ª–µ—Ç–∫–∞ ${cellNumber} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–∞—Ä–º–∏—á–µ—Å–∫–æ–π`);
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–∞—Ä–º—ã (—Ö–æ—Ä–æ—à–∞—è/–ø–ª–æ—Ö–∞—è/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è)
            const isGood = karmaInfo.type === 'good';
            const isBad = karmaInfo.type === 'bad';
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–ª–µ—Ç–∫—É —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–µ—Ç–∫–∏
            if (isGood) {
                GridSystem.highlightCell(cellNumber, 'active');
            } else if (isBad) {
                GridSystem.highlightCell(cellNumber, 'visited');
            } else {
                GridSystem.highlightCell(cellNumber, 'path');
            }
            
            console.log(`–≠—Ñ—Ñ–µ–∫—Ç –∫–∞—Ä–º—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–ª–µ—Ç–∫–∏ ${cellNumber}: ${karmaInfo.name}`);
        };
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü body –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ —Å–ª–µ–¥–∞
        document.addEventListener('keydown', function(e) {
            // –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à 1-5 –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ü–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã
            if (e.key >= '1' && e.key <= '5') {
                const schemeIndex = parseInt(e.key) - 1;
                GridSystem.setColor(schemeIndex);
                console.log(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É ${e.key}`);
            }
            
            // –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ 'b' —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —è—Ä–∫–æ—Å—Ç—å
            if (e.key === 'b') {
                GridSystem.setAnimationParams({
                    intensity: 1.5  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
                });
                console.log('–Ø—Ä–∫–æ—Å—Ç—å –ª–∏–Ω–∏–π —É–≤–µ–ª–∏—á–µ–Ω–∞');
            }
            
            // –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ 'd' —É–º–µ–Ω—å—à–∞–µ—Ç —è—Ä–∫–æ—Å—Ç—å
            if (e.key === 'd') {
                GridSystem.setAnimationParams({
                    intensity: 0.8  // –£–º–µ–Ω—å—à–∞–µ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
                });
                console.log('–Ø—Ä–∫–æ—Å—Ç—å –ª–∏–Ω–∏–π —É–º–µ–Ω—å—à–µ–Ω–∞');
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –∫–ª–µ—Ç–∫—É
                GridSystem.highlightCell(1);
                console.log('–ù–∞—á–∞–ª—å–Ω–∞—è –∫–ª–µ—Ç–∫–∞ –ø–æ–¥—Å–≤–µ—á–µ–Ω–∞');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—É—Ç—å
                setTimeout(function() {
                    GridSystem.highlightPath([2, 3, 4, 5]);
                    console.log('–¢–µ—Å—Ç–æ–≤—ã–π –ø—É—Ç—å —Å–æ–∑–¥–∞–Ω');
                }, 2000);
            }, 1000);
        });
    </script>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        function removeOldHighlightElements() {
            console.log('–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–¥—Å–≤–µ—Ç–∫–∏...');
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ª–∏–Ω–∏–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const oldLines = document.querySelectorAll('.grid-line-highlight');
            oldLines.forEach(line => line.remove());
            console.log(`–£–¥–∞–ª–µ–Ω–æ ${oldLines.length} —Å—Ç–∞—Ä—ã—Ö –ª–∏–Ω–∏–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏`);
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ—á–∫–∏ —Å–ª–µ–¥–∞
            const oldDots = document.querySelectorAll('.trail-dot, .simple-trail-dot, .forced-trail-dot');
            oldDots.forEach(dot => dot.remove());
            console.log(`–£–¥–∞–ª–µ–Ω–æ ${oldDots.length} —Å—Ç–∞—Ä—ã—Ö —Ç–æ—á–µ–∫ —Å–ª–µ–¥–∞`);
        }
        
        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            removeOldHighlightElements();
            
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            setTimeout(removeOldHighlightElements, 1000);
            
            // –ò –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(removeOldHighlightElements, 3000);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ä—è—á—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
        document.addEventListener('keydown', function(e) {
            // –ö–ª–∞–≤–∏—à–∞ 'r' - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (e.key === 'r') {
                removeOldHighlightElements();
                console.log('–°—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —É–¥–∞–ª–µ–Ω—ã –≤—Ä—É—á–Ω—É—é');
            }
        });
    </script>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏
        function demonstrateAnimationModes() {
            console.log('–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏...');
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å —Ä–µ–∂–∏–º–∞ "–∫–ª–µ—Ç–∫–∏"
            GridSystem.setAnimationMode('cell');
            
            // –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            setTimeout(() => {
                GridSystem.setAnimationMode('vertical');
                console.log('–†–µ–∂–∏–º: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏');
            }, 5000);
            
            // –ï—â–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            setTimeout(() => {
                GridSystem.setAnimationMode('horizontal');
                console.log('–†–µ–∂–∏–º: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏');
            }, 10000);
            
            // –ò –Ω–∞–∫–æ–Ω–µ—Ü –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Ä–µ–∂–∏–º—É "–∫–ª–µ—Ç–∫–∏"
            setTimeout(() => {
                GridSystem.setAnimationMode('cell');
                console.log('–†–µ–∂–∏–º: –∫–ª–µ—Ç–∫–∏');
            }, 15000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏
        function demonstrateAnimationPresets() {
            console.log('–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ—Å–µ—Ç–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏...');
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å –Ω–µ–∂–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞
            GridSystem.setAnimationPreset('gentle');
            
            // –ß–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–µ—Å–µ—Ç
            setTimeout(() => {
                GridSystem.setAnimationPreset('medium');
                console.log('–ü—Ä–µ—Å–µ—Ç: medium');
            }, 8000);
            
            // –ï—â–µ —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥–∏–Ω–∞–º–∏—á–Ω—ã–π –ø—Ä–µ—Å–µ—Ç
            setTimeout(() => {
                GridSystem.setAnimationPreset('dynamic');
                console.log('–ü—Ä–µ—Å–µ—Ç: dynamic');
            }, 16000);
            
            // –ò –Ω–∞–∫–æ–Ω–µ—Ü –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–µ–∂–Ω–æ–º—É –ø—Ä–µ—Å–µ—Ç—É
            setTimeout(() => {
                GridSystem.setAnimationPreset('gentle');
                console.log('–ü—Ä–µ—Å–µ—Ç: gentle');
            }, 24000);
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                demonstrateAnimationModes();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–µ—Å–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ 20 —Å–µ–∫—É–Ω–¥
                setTimeout(demonstrateAnimationPresets, 20000);
            }, 3000);
        });
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ strobe-trail.js –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º body -->
    <script src="strobe-trail.js"></script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —ç—Ñ—Ñ–µ–∫—Ç–∞ -->
    <script>
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–æ–±–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ StrobeTrail –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
            setTimeout(function() {
                if (window.configureStrobeTrail) {
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    window.configureStrobeTrail({
                        flashDuration: 150,       // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–ø—ã—à–∫–∏
                        flashInterval: 100,       // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –≤—Å–ø—ã—à–∫–∞–º–∏
                        flashCount: 5,            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–ø—ã—à–µ–∫
                        colors: [
                            'rgba(255, 255, 255, 1.0)',  // –ë–µ–ª—ã–π (—è—Ä—á–µ)
                            'rgba(0, 255, 0, 1.0)',      // –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω—ã–π
                            'rgba(255, 215, 0, 1.0)'     // –ó–æ–ª–æ—Ç–æ–π (—è—Ä—á–µ)
                        ]
                    });
                    console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–æ–±–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
                    
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –≤—Å–ø—ã—à–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                    setTimeout(function() {
                        if (window.createStrobeFlash) {
                            window.createStrobeFlash(6); // –í—Å–ø—ã—à–∫–∞ –¥–ª—è –∫–ª–µ—Ç–∫–∏ 6
                            console.log('–¢–µ—Å—Ç–æ–≤–∞—è –≤—Å–ø—ã—à–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –∫–ª–µ—Ç–∫–∏ 6');
                        }
                    }, 1000);
                } else {
                    console.error('StrobeTrail –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
            }, 2000);
        });
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–µ—Ç–∫–∏ 68 -->
    <script src="cell68-effect.js"></script>
    
    <!-- –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
    <script src="end-game-handler.js"></script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <script src="matrix-comments.js"></script>
    
    <!-- –ú–∞—Ç—Ä–∏—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
            setTimeout(function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –º–∞—Ç—Ä–∏—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                if (window.MatrixComments && typeof window.MatrixComments.init === 'function') {
                    // –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–∞
                    window.addEventListener('diceRoll', function(e) {
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ diceRolled –¥–ª—è –º–∞—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–∞
                        document.dispatchEvent(new CustomEvent('diceRolled', {
                            detail: {
                                value: e.detail.result,
                                isFirstRoll: window.currentPosition === 1 || !window.currentPosition
                            }
                        }));
                    });
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
                    if (typeof window.movePlayer === 'function') {
                        const originalMovePlayer = window.movePlayer;
                        window.movePlayer = function(newPosition) {
                            const oldPosition = window.currentPosition || 1;
                            
                            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                            const result = originalMovePlayer.apply(this, arguments);
                            
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
                            document.dispatchEvent(new CustomEvent('gamePositionChanged', {
                                detail: {
                                    from: oldPosition,
                                    to: newPosition,
                                    position: newPosition
                                }
                            }));
                            
                            return result;
                        };
                        
                        console.log("–§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞ –¥–ª—è –º–∞—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–∞");
                    }
                    
                    console.log("–°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–∞—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
                } else {
                    console.warn("–°–∏—Å—Ç–µ–º–∞ –º–∞—Ç—Ä–∏—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞");
                }
            }, 500);
        });
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–±–∞–≥-–∫–æ–Ω—Ç—Ä–æ–ª—ã -->
    <script src="debug-controls.js"></script>

    <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
    <div id="debug-controls" class="debug-panel">
        <button id="test-cell68-btn" class="debug-btn">–¢–µ—Å—Ç –∫–ª–µ—Ç–∫–∏ 68</button>
        <button id="reset-pos-btn" class="debug-btn" style="margin-top: 5px;">–í–µ—Ä–Ω—É—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
    </div>
    
    <!-- –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–∂–∏–¥–∞–Ω–∏—è —à–µ—Å—Ç–µ—Ä–∫–∏ -->
    <script src="message-fix.js"></script>
    
    <!-- –ú–æ–¥—É–ª—å –ø—Ä–∞–≤–∏–ª–∞ —à–µ—Å—Ç–µ—Ä–æ–∫ -->
    <script src="six-rule.js"></script>
    
    <!-- –û—Ç–ª–∞–¥—á–∏–∫ –ø—Ä–∞–≤–∏–ª–∞ —à–µ—Å—Ç–µ—Ä–æ–∫ -->
    <script src="six-rule-debugger.js"></script>
</body>
</html>